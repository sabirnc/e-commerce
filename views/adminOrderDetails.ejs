<!DOCTYPE html>
<html lang="en">

<head>
    <!-- metas -->
    <meta charset="utf-8" />
    <meta name="author" content="Chitrakoot Web" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="keywords" content="admin,dashboard" />
    <meta name="description" content="Smartshop - Responsive eCommerce Admin Dashboard" />

    <!-- title  -->
    <title>MOLLA ADMIN</title>
    <!-- favicon -->
    <link rel="shortcut icon" href="/img/logos/favicon.png" />
    <link rel="apple-touch-icon" href="/img/logos/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/img/logos/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/img/logos/apple-touch-icon-114x114.png" />

    <!-- common plugins -->
    <link rel="stylesheet" href="/plugins/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/plugins/font-awesome/css/font-awesome.min.css" />
    <link rel="stylesheet" href="/plugins/icomoon/style.css" />
    <link rel="stylesheet" href="/plugins/uniform/css/default.css" />
    <link rel="stylesheet" href="/plugins/switchery/switchery.min.css" />
    <!--html2canvas-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>
    <!--jspdf-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>

    <!-- datepicker css -->
    <link rel="stylesheet" href="/plugins/bootstrap-datepicker/css/datepicker.css" />

    <!-- theme core css -->
    <link rel="stylesheet" href="/css/styles.css" />

</head>

<body>

    <!-- PAGE LOADING
    ================================================== -->
    <div id="preloader"></div>

    <!-- PAGE CONTAINER
    ================================================== -->
    <div class="page-container">

        <!-- PAGE SIDEBAR
        ================================================== -->
        <%-include("./partials/adminsidebar.ejs")  %>
        <!-- PAGE CONTENT
        ================================================== -->
        <div class="page-content">

            <!-- PAGE HEADER
            ================================================== -->
            <div class="page-header">
                <div class="search-form">
                    <form action="#" method="GET">
                        <div class="input-group">
                            <input type="text" name="search" class="form-control search-input" placeholder="Type something...">
                            <span class="input-group-btn">
                                <button class="btn btn-default" id="close-search" type="button"><i class="icon-close"></i></button>
                            </span>
                        </div>
                    </form>
                </div>
                <nav class="navbar navbar-default">
                    <!-- /.container-fluid -->
                </nav>
            </div>

            <!-- PAGE INNER
            ================================================== -->
            <div class="page-inner">
                <!-- PAGE MAIN WRAPPER
                ================================================== -->
                <div id="main-wrapper">
                    <!-- row -->
                    <div class="row g-xl-3">
                        <div class="col-xl-4 grid-margin">
                            <div class="card card-white h-100">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">General</h4>
                                </div>
                                <div class="card-body">

                                    <form class="needs-validation" novalidate>
                                        <div class="row">
                                            <div class="col-md-12 mb-2">
                                                <div class="form-group">
                                                    <label for="validationCustom01">Status</label>
                                                    <select class="form-select form-control" id="validationCustom01" aria-label="Default select example" onchange="statusChange('<%=orderDetails._id%>')">
                                                        <option value="order confirmed">order confirmed</option>
                                                        <option value="packing">packing</option>
                                                        <option value="shipped">shipped</option>
                                                        <option value="delivered">delivered</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-12 mb-2">
                                                <div class="form-group">
                                                    <label>Date Created</label>
                                                    <div>
                                                        <input type="text" class="form-control date-picker">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <label for="validationCustom02">Billing Name</label>
                                                <input type="text" class="form-control" id="validationCustom02">
                                            </div>
                                        </div>
                                    </form>

                                </div>
                            </div>
                        </div>
                        <div class="col-xl-8 grid-margin">
                            <div class="card card-white h-100">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">Addresses</h4>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-lg-auto me-xl-5 pe-xl-5 mb-4 mb-xl-0">
                                            <h6 class="text-uppercase fw-bold mb-3">billing</h6>
                                            <ul class="list-unstyled ps-0">
                                                <li>Mohammed ali road</li>
                                                <li>67445</li>
                                                <li>Mumbai</li>
                                                <li>Maharashtra</li>
                                                <li>India</li>
                                            </ul>
                                            <strong class="d-block">Email address:</strong>
                                            <a href="#">MollaStore@gmail.com</a>
                                            <strong class="d-block mt-3">Phone:</strong>
                                            <a href="#">0495 234567</a>
                                        </div>
                                        <div class="col-lg-auto ps-xl-5">
                                            <h6 class="fw-bold text-uppercase mb-3">shipping</h6>
                                            <ul class="list-unstyled ps-0">
                                                <li><%=orderDetails.address.name %> </li>
                                                <li><%= orderDetails.address.street %></li>
                                                <li><%= orderDetails.address.postcode%> </li>
                                                <li><%=orderDetails.address.city%> </li>
                                                <li><%=orderDetails.address.state%> </li>
                                                <li><%=orderDetails.address.country  %> </li>
                                            </ul>
                                            <strong class="d-block">Email address:</strong>
                                            <a href="#"> <%=orderDetails.user.email%></a>
                                            <strong class="d-block mt-3">Phone:</strong>
                                            <a href="#5551234"><%=orderDetails.address.mobile%> </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end row -->

                    <!-- row -->
                    <div class="row g-xl-3">
                        <div class="col-lg-12 grid-margin">
                            <div class="card card-white h-100">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">Products</h4>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table mb-0 order-details-table">
                                            <thead class="bg-light">
                                                <tr>
                                                    <th class="ps-4 id">ID</th>
                                                    <th class="name">Name</th>
                                                    <th class="text-end cost">Cost</th>
                                                    <th class="text-end qty">Qty</th>
                                                    <th class="text-end total">Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                              <% orderDetails.products.map( product => {%> 
                                                <tr>
                                                    <td class="ps-4"><a href="#"><strong>290397</strong></a></td>
                                                    <td><a href="#"></a><%= product.product.productName  %> </td>
                                                    <td class="text-end">$<%=product.product.productPrize  %> </td>
                                                    <td class="text-end"><%=product.quantity%> </td>
                                                    <td class="text-end"><%= product.totalPrice%></td>
                                                </tr>
                                              <% }) %> 
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="row justify-content-end flex-column flex-lg-row mt-5">
                                        <div class="col-auto me-5">
                                            <h6 class="fw-bold mb-2">Items Subtotal</h6>
                                            <span class="d-flex align-items-center">
                                               <%= orderDetails.products.length  %>  Items
                                                <i class="fas fa-chevron-right f-s-11 text-primary px-3"></i>
                                                <b>$<%=orderDetails.total  %> </b>
                                            </span>
                                        </div>
                                        <div class="col-auto">
                                            <h6 class="fw-bold mb-2">Order Total</h6>
                                            <span class="d-flex align-items-center justify-content-lg-end">
                                                <strong>$<%=orderDetails.total%> </strong>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end row -->

                    <!-- row -->
                    <div class="row g-xl-3">
                        <div class="col-xl-4 grid-margin">
                            <div class="card card-white h-100">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">Shipping Information</h4>
                                </div>
                                <div class="card-body">
                                    <table class="table table-borderless mb-0">
                                        <tbody>
                                            <tr>
                                                <th colspan="2">
                                                    <p class="m-0"><%=orderDetails.user.fullName%> </p>
                                                </th>
                                            </tr>
                                            <tr>
                                                <th scope="row">Address:</th>
                                                <td>
                                                  <%= orderDetails.address.street  %>
                                                  <%= orderDetails.address.city  %>
                                                  <%= orderDetails.address.state  %>
                                                  <%= orderDetails.address.postcode  %>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Phone :</th>
                                                <td><%=orderDetails.address.mobile%> </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-xl-4 grid-margin">
                            <div class="card card-white h-100">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">Billing Information</h4>
                                </div>
                                <div class="card-body">
                                    <table class="table table-borderless table-sm mb-0">
                                        <tbody>

                                            <% if(orderDetails.payment == "Cash On Delivery"){ %> 
                                                <tr>
                                                    <th scope="row">Payment Type:</th>
                                                    <td>Cash On Delivery</td>
                                                </tr>
                                            <% }else{ %> 
                                                <tr>
                                                    <th scope="row">Payment Type:</th>
                                                    <td>Credit Card</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Provider :</th>
                                                    <td>Visa ending in 2851</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Valid Date :</th>
                                                    <td>02/2021</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">CVV :</th>
                                                    <td>xxx</td>
                                                </tr>
                                            <% } %> 
                                           
                                           
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-xl-4 grid-margin">
                            <div class="card card-white h-100">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">Delivery Info</h4>
                                </div>
                                <div class="card-body">
                                    <div class="text-center">
                                        <div class="my-2">
                                            <i class="fas fa-truck-moving h1 text-muted"></i>
                                        </div>
                                        <h5><b>UPS Delivery</b></h5>
                                        <div class="mt-2 pt-1">
                                            <p class="mb-1"><span>Order ID :</span> xxxx048</p>
                                            <p class="mb-0"><span>Payment Mode :</span> COD</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end row -->

                    <div>
                        <button  class="btn btn-primary" onclick="print()">Download</button>
                    </div>

                </div>

              
            </div>

        </div>

    </div>
     
    <script>
        const select = document.getElementById("validationCustom01");
        async function statusChange(id){
          try{
            const res = await fetch("/admin/order-status" , {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({status:select.value , id})
          }) 
          } 
          catch(err){
            console.log(err)
          }
        }
    </script> 

    <script>
      window.jsPDF = window.jspdf.jsPDF;
      var docPDF = new jsPDF()
      function print(){
        let page = document.querySelector(".page-inner")
        docPDF.html(page ,{
          callback: function(docPDF){
            docPDF.save("invoice.pdf")
          },
          windowWidth:650,
          width:100,
          x:15,



        })
      }
    </script>
    
    <!-- SCROLL TO TOP
    ================================================== -->
    <a href="#" class="scroll-to-top"><i class="fas fa-angle-up" aria-hidden="true"></i></a>

    <!-- ALL JS INCLUDE
    ================================================== -->

    <!-- jQuery -->
    <script src="/plugins/jquery/jquery.min.js"></script>

    <!-- popper -->
    <script src="/plugins/popper/js/popper.min.js"></script>

    <!-- bootstrap -->
    <script src="/plugins/bootstrap/js/bootstrap.min.js"></script>

    <!-- slimscroll -->
    <script src="/plugins/jquery-slimscroll/jquery.slimscroll.min.js"></script>

    <!-- uniform -->
    <script src="/plugins/uniform/js/jquery.uniform.standalone.js"></script>

    <!-- switchery -->
    <script src="/plugins/switchery/switchery.min.js"></script>

    <!-- datepicker -->
    <script src="/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>

    <!-- form elements -->
    <script src="/js/pages/form-elements.js"></script>

    <!-- theme core scripts -->
    <script src="/js/main.js"></script>

    <!-- all js include end -->
</body>

</html>